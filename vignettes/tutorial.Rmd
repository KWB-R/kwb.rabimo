---
title: "How to Simulate Water Balance with R-Abimo"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to Simulate Water Balance with R-Abimo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Background

This package provides an R-implementation and extension of the simple water 
balance model Berlin ABIMO 3.2, which was originally developed by the Federal
Institute of Hydrology ([Bundesanstalt für Gewässerkunde](https://www.bafg.de)) 
for rural areas and later adapted for urban areas, namely the German capital
Berlin. In May 2022, the source code of the model was published on the developer
platform [GitHub](https://github.com/umweltatlas/abimo). 

During the research project [AMAREX](https://amarex-projekt.de/de) (an acronym 
for the German translation of "adaptation of stormwater management to extreme
events"), funded by the former Federal Ministry of Education and Research
([Bundesministerium für Bildung und Forschung -- BMBF](https://www.bmbf.de/DE/Home/home_node.html)), we, the authors from Kompetenzzentrum Wasser Berlin gGmbH (KWB)](https://kompetenz-wasser.de/de) 
started to work on the original program code, written in the programming language C++ [https://github.com/KWB-R/abimo](https://github.com/KWB-R/abimo/). 
We decided to transfer the model to the programming language R, to rename it to
R-ABIMO (see e.g. [here](https://amarex-projekt.de/en/news/abimo-r-abimo)) 
and to publish it in the form of this R package ([kwb.rabimo](https://github.com/KWB-R/kwb.rabimo)). 
Compared to the original model, R-ABIMO is more generic (i.e. can be more easily
adapted to other cities than Berlin) and it contains some additional features:

- simulation of rainmwater management measures (green roofs, swales)
- "conversion" of urban areas to "natural" areas
- calculation of delta-W, an indicator for the "distance" between status quo (urban) and "natural" state.

## Installation

```{r setup}
# Install package "remotes" from CRAN
install.packages("remotes", repos = "https://cloud.r-project.org")

# Install package "kwb.rabimo" (latest "release") from GitHub
remotes::install_github("KWB-R/kwb.rabimo")

# Install package "kwb.rabimo" (development version) from GitHub
remotes::install_github("KWB-R/kwb.rabimo@dev")
```

## Basic Usage

### Provide input data and configuration

Compared to the original C++ version of Abimo we have modified the structures
of input data, output data and configuration.

For the German city of Berlin, we provide data in the new structures in the 
package:

```r
# Load Berlin data in the original Abimo format
abimo_inputs <- kwb.rabimo::rabimo_inputs_2025
```

### Run R-Abimo for the status quo

```r
# Run R-Abimo, the R-implementation of Abimo
rabimo_result <- kwb.rabimo::run_rabimo(
  data = abimo_inputs$data, 
  config = abimo_inputs$config
)

# Have a look at the first lines of the result data frame
head(rabimo_result)
```

### Run R-Abimo for a natural state scenario

```r
rabimo_result_natural <- kwb.rabimo::run_rabimo(
  data = kwb.rabimo::data_to_natural(abimo_inputs$data), 
  config = new_inputs$config
)
```

### Calculate "Delta-W"

For the first ten blocks, calculate the deviation from the natural state:

```r
kwb.rabimo::calculate_delta_w(
  urban = rabimo_result[1:10, ],
  natural = rabimo_result_natural
)
```

## Documentation

Release: [https://kwb-r.github.io/kwb.rabimo](https://kwb-r.github.io/kwb.rabimo)

Development: [https://kwb-r.github.io/kwb.rabimo/dev](https://kwb-r.github.io/kwb.rabimo/dev)
