<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to Simulate Water Balance with R-Abimo • kwb.rabimo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to Simulate Water Balance with R-Abimo">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kwb.rabimo</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tutorial.html">How to Simulate Water Balance with R-Abimo</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/KWB-R/kwb.rabimo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to Simulate Water Balance with R-Abimo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/kwb.rabimo/blob/dev/vignettes/tutorial.Rmd" class="external-link"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This package provides an R-implementation and extension of the simple
water balance model Berlin ABIMO 3.2, which was originally developed by
the Federal Institute of Hydrology (<a href="https://www.bafg.de" class="external-link">Bundesanstalt für Gewässerkunde</a>) for
rural areas and later adapted for urban areas, namely for Berlin,
Germany. In May 2022, the source code of the model was published on the
developer platform GitHub (<a href="https://github.com/umweltatlas/abimo" class="external-link">https://github.com/umweltatlas/abimo</a>).</p>
<p>During the research project <a href="https://amarex-projekt.de/de" class="external-link">AMAREX</a> (an acronym for the
German translation of “adaptation of stormwater management to extreme
events”), funded by the former German Federal Ministry of Education and
Research (<a href="https://www.bmbf.de/DE/Home/home_node.html" class="external-link">Bundesministerium für
Bildung und Forschung – BMBF</a>), we, the package authors from <a href="https://kompetenz-wasser.de/de" class="external-link">Kompetenzzentrum Wasser Berlin
gGmbH (KWB)</a> started to work on the original program code, written in
the programming language C++ (<a href="https://github.com/KWB-R/abimo/" class="external-link">https://github.com/KWB-R/abimo</a>).
We then decided to transfer the model to the <a href="https://www.r-project.org/" class="external-link">programming language R</a>, to rename
it to R-Abimo (see e.g. <a href="https://amarex-projekt.de/en/news/abimo-r-abimo" class="external-link">here</a>) and to
publish it in the form of this R package <a href="https://github.com/KWB-R/kwb.rabimo" class="external-link">kwb.rabimo</a>. Compared to
the original model, R-Abimo is more generic (i.e. can be more easily
adapted to other cities than Berlin) and it contains some additional
features:</p>
<ul>
<li>simulation of stormwater management measures (green roofs,
swales),</li>
<li>“conversion” of urban areas to “natural” areas,</li>
<li>calculation of delta-W, an indicator for the “distance” between the
urban (status quo) state and an assumed “natural” state.</li>
</ul>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>To use the package, you need to have R installed in a version &gt;=
4.3.1. You can download the current version of R from <a href="https://cran.r-project.org/bin/windows/base/" class="external-link">here</a>. Not
necessary, but useful is the usage of an Integrated Development
Environment (IDE), such as RStudio Desktop that can be downloaded from
<a href="https://posit.co/download/rstudio-desktop/" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>In order to install kwb.rabimo directly from our GitHub account <a href="https://github.com/kwb-r/" class="external-link">KWB-R</a>, we recommend to install the
R package remotes first:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package "remotes" from CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span></code></pre></div>
<p>You can then install kwb.rabimo either in the latest “official”
version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package "kwb.rabimo" (latest "release") from GitHub</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"KWB-R/kwb.rabimo"</span><span class="op">)</span></span></code></pre></div>
<p>or in the latest “development” version:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package "kwb.rabimo" (development version) from GitHub</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"KWB-R/kwb.rabimo@dev"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>By setting <code>build_vignettes = TRUE</code> you make sure that
this tutorial vignette is installed together with the package. Please
note that this tutorial is currently only available in the “development”
version.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<div class="section level3">
<h3 id="provide-input-data-and-configuration">Provide input data and configuration<a class="anchor" aria-label="anchor" href="#provide-input-data-and-configuration"></a>
</h3>
<p>Compared to the original C++ version of Abimo we have modified the
structures of input data, output data and configuration. For Berlin,
Germany, we provide data in the new structures in the package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Berlin data in the original Abimo format</span></span>
<span><span class="va">abimo_inputs</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="va"><a href="../reference/rabimo_inputs_2025.html">rabimo_inputs_2025</a></span></span></code></pre></div>
<p>The object <code>abimo_inputs</code> is a list with two elements:</p>
<ul>
<li>
<code>abimo_inputs$data</code> is a data frame containing the actual
input data. Each row represents a block area and each column represents
a block area’s property.</li>
<li>
<code>abimo_inputs$config</code> is a list that configures runoff
factors (for runoff calculation) and Bagrov values (for
evapotranspiration calculation) for different surface types and the
swale evaporation factor that determines which fraction of the water
going into a swale becomes evaporation (the rest becomes
infiltration).</li>
</ul>
<p>You may inspect the first rows of the input data with</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">abimo_inputs</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 25 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 389221.4 ymin: 5821678 xmax: 389842.4 ymax: 5822110</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span><span class="co">#&gt;               code prec_yr prec_s epot_yr epot_s district total_area      roof</span></span>
<span><span class="co">#&gt; 1 0100980011000100     608    324     666    509        1   4623.972 0.3243243</span></span>
<span><span class="co">#&gt; 2 0100980011000200     607    324     666    509        1  13430.944 0.0004668</span></span>
<span><span class="co">#&gt; 3 0100980011000300     607    324     666    509        1   5603.764 0.3893303</span></span>
<span><span class="co">#&gt; 4 0100980021000200     609    324     666    509        1  34344.730 0.4511181</span></span>
<span><span class="co">#&gt; 5 0100980021000300     608    324     666    509        1  48930.206 0.4155595</span></span>
<span><span class="co">#&gt; 6 0100980021000400     609    324     666    509        1  13977.561 0.0939597</span></span>
<span><span class="co">#&gt;   green_roof swg_roof       pvd swg_pvd srf1_pvd srf2_pvd srf3_pvd srf4_pvd</span></span>
<span><span class="co">#&gt; 1     0.0000     0.86 0.3704374    0.50     0.49     0.46     0.03     0.02</span></span>
<span><span class="co">#&gt; 2     0.0000     0.70 0.4371382    0.68     0.31     0.53     0.07     0.09</span></span>
<span><span class="co">#&gt; 3     0.0939     0.76 0.4414658    0.55     0.20     0.60     0.10     0.10</span></span>
<span><span class="co">#&gt; 4     0.2134     0.94 0.3339549    0.75     0.45     0.28     0.13     0.14</span></span>
<span><span class="co">#&gt; 5     0.0277     0.73 0.3574335    0.61     0.42     0.38     0.08     0.12</span></span>
<span><span class="co">#&gt; 6     0.0000     0.82 0.4508725    0.78     0.31     0.56     0.01     0.12</span></span>
<span><span class="co">#&gt;   srf5_pvd to_swale gw_dist ufc30 ufc150 land_type veg_class irrigation</span></span>
<span><span class="co">#&gt; 1        0        0     5.9    13     10     urban       9.5          0</span></span>
<span><span class="co">#&gt; 2        0        0     5.2    11     10     urban       3.6          0</span></span>
<span><span class="co">#&gt; 3        0        0     4.5    13     10     urban       1.5          0</span></span>
<span><span class="co">#&gt; 4        0        0     5.4    13     10     urban       5.3          0</span></span>
<span><span class="co">#&gt; 5        0        0     5.6    12     10     urban      13.2         50</span></span>
<span><span class="co">#&gt; 6        0        0     4.5    11     10     urban       2.7          0</span></span>
<span><span class="co">#&gt;                                                                                           block_type</span></span>
<span><span class="co">#&gt; 1 10_11_Residential_Free_row_development_with_landscaped_settlement_greenery_1950s_1970s_2_6_stories</span></span>
<span><span class="co">#&gt; 2                                                     80_91_Traffic_area_excluding_roads_Parking_lot</span></span>
<span><span class="co">#&gt; 3                           10_73_Residential_Multi_story_apartment_buildings_of_the_1990s_and_later</span></span>
<span><span class="co">#&gt; 4                 10_8_Residential_Heterogeneous_inner_city_mixed_development_gap_closure_after_1945</span></span>
<span><span class="co">#&gt; 5                                                                   50_46_Community_service_Hospital</span></span>
<span><span class="co">#&gt; 6                                                       60_32_Suppy_and_disposal_Supply_and_disposal</span></span>
<span><span class="co">#&gt;                            Shape</span></span>
<span><span class="co">#&gt; 1 MULTIPOLYGON (((389326.2 58...</span></span>
<span><span class="co">#&gt; 2 MULTIPOLYGON (((389262 5821...</span></span>
<span><span class="co">#&gt; 3 MULTIPOLYGON (((389262 5821...</span></span>
<span><span class="co">#&gt; 4 MULTIPOLYGON (((389382.3 58...</span></span>
<span><span class="co">#&gt; 5 MULTIPOLYGON (((389382.3 58...</span></span>
<span><span class="co">#&gt; 6 MULTIPOLYGON (((389567.3 58...</span></span></code></pre></div>
<p>and you may print the whole configuration object with</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">abimo_inputs</span><span class="op">$</span><span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; $runoff_factors</span></span>
<span><span class="co">#&gt;     roof surface1 surface2 surface3 surface4 surface5 </span></span>
<span><span class="co">#&gt;     1.00     0.90     0.70     0.40     0.10     0.48 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bagrov_values</span></span>
<span><span class="co">#&gt;       roof green_roof   surface1   surface2   surface3   surface4   surface5 </span></span>
<span><span class="co">#&gt;       0.05       0.65       0.11       0.11       0.25       0.40       0.25 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $swale</span></span>
<span><span class="co">#&gt; swale_evaporation_factor </span></span>
<span><span class="co">#&gt;                      0.1</span></span></code></pre></div>
<p>Please refer to the help page of <code>rabimo_inputs_2025</code> for
further information. To open the help page, run</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="va"><a href="../reference/rabimo_inputs_2025.html">rabimo_inputs_2025</a></span></span></code></pre></div>
<p>Note: We provide also an object <code>rabimo_inputs_2020</code>, that
refers to an older version of the Berlin data set. It can be used in
almost the same way as <code>rabimo_inputs_2025</code>. However, this
old version does not contain geographic information and we do not cover
it within this tutorial.</p>
<p>Since the we provide the Berlin dataset together with geographical
information we can plot the data in forms of maps. In the following we
plot</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the sf package (simple features) to allow for geographical plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.13.1, GDAL 3.11.0, PROJ 9.6.0; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="co"># Provide a subset of the data representing a zoom into the centre of Berlin</span></span>
<span><span class="va">berlin_zoom</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/crop_box.html">crop_box</a></span><span class="op">(</span></span>
<span>  <span class="va">abimo_inputs</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  xoffset <span class="op">=</span> <span class="fl">0.35</span>, </span>
<span>  yoffset <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>  xscale <span class="op">=</span> <span class="fl">0.07</span>, </span>
<span>  yscale <span class="op">=</span> <span class="fl">0.07</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">#&gt; all geometries</span></span>
<span></span>
<span><span class="co"># Plot annual precipitation and annual potential evaporation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">berlin_zoom</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prec_yr"</span>, <span class="st">"epot_yr"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>TODO:</p>
<ul>
<li><strong>Plot der Input-Daten ohne Farben (für Visualisierung der
Geometrie)</strong></li>
<li><strong>run_rabimo + Visualisierung der Ergebnisse</strong></li>
<li><strong>generate_rabimo_area mit default Werten</strong></li>
</ul>
</div>
<div class="section level3">
<h3 id="run-r-abimo-for-the-status-quo">Run R-Abimo for the status quo<a class="anchor" aria-label="anchor" href="#run-r-abimo-for-the-status-quo"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run R-Abimo, the R-implementation of Abimo</span></span>
<span><span class="va">rabimo_result</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/run_rabimo.html">run_rabimo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">abimo_inputs</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  config <span class="op">=</span> <span class="va">abimo_inputs</span><span class="op">$</span><span class="va">config</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Have a look at the first lines of the result data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rabimo_result</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-r-abimo-for-a-natural-state-scenario">Run R-Abimo for a natural state scenario<a class="anchor" aria-label="anchor" href="#run-r-abimo-for-a-natural-state-scenario"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rabimo_result_natural</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/run_rabimo.html">run_rabimo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/data_to_natural.html">data_to_natural</a></span><span class="op">(</span><span class="va">abimo_inputs</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>, </span>
<span>  config <span class="op">=</span> <span class="va">new_inputs</span><span class="op">$</span><span class="va">config</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-delta-w">Calculate “Delta-W”<a class="anchor" aria-label="anchor" href="#calculate-delta-w"></a>
</h3>
<p>For the first ten blocks, calculate the deviation from the natural
state:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_delta_W.html">calculate_delta_w</a></span><span class="op">(</span></span>
<span>  urban <span class="op">=</span> <span class="va">rabimo_result</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>,</span>
<span>  natural <span class="op">=</span> <span class="va">rabimo_result_natural</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>Release: <a href="https://kwb-r.github.io/kwb.rabimo">https://kwb-r.github.io/kwb.rabimo</a></p>
<p>Development: <a href="https://kwb-r.github.io/kwb.rabimo/dev">https://kwb-r.github.io/kwb.rabimo/dev</a></p>
<p>Delta-W: Bedeutung + Formel DeltaW data_to_natural + WHH im nat.
Referenzszenario berechnen. (evtl. hier Korrektur erforderlich weil
Geodaten nicht supported) calculate_delta_w RWBM sehr kurze Intro zu den
implementierten RWBM (inkl. dass man den pvd Anteil ändern kann?) wie
man gezielt einen Wert in einer bestimmten Spalte (z.B. green_roof) oder
in alle Spalten ändert Plot von vorher vs. nachher</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hauke Sonnenberg, Francesco Del Punta.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
