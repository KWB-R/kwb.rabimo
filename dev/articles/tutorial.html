<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to Simulate Water Balance with R-Abimo • kwb.rabimo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to Simulate Water Balance with R-Abimo">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kwb.rabimo</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tutorial.html">How to Simulate Water Balance with R-Abimo</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/KWB-R/kwb.rabimo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to Simulate Water Balance with R-Abimo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/kwb.rabimo/blob/dev/vignettes/tutorial.Rmd" class="external-link"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This package provides an R-implementation and extension of the simple
water balance model Berlin ABIMO 3.2, which was originally developed by
the Federal Institute of Hydrology (<a href="https://www.bafg.de" class="external-link">Bundesanstalt für Gewässerkunde</a>) for
rural areas and later adapted for urban areas, namely for Berlin,
Germany. In May 2022, the source code of the model was published on the
developer platform GitHub (<a href="https://github.com/umweltatlas/abimo" class="external-link">https://github.com/umweltatlas/abimo</a>).</p>
<p>During the research project <a href="https://amarex-projekt.de/de" class="external-link">AMAREX</a> (an acronym for the
German translation of “adaptation of stormwater management to extreme
events”), funded by the former German Federal Ministry of Education and
Research (<a href="https://www.bmbf.de/DE/Home/home_node.html" class="external-link">Bundesministerium für
Bildung und Forschung – BMBF</a>), we, the package authors from <a href="https://kompetenz-wasser.de/de" class="external-link">Kompetenzzentrum Wasser Berlin
gGmbH (KWB)</a> started to work on the original program code, written in
the programming language C++ (<a href="https://github.com/KWB-R/abimo/" class="external-link">https://github.com/KWB-R/abimo</a>).
We then decided to transfer the model to the <a href="https://www.r-project.org/" class="external-link">programming language R</a>, to rename
it to R-Abimo (see e.g. <a href="https://amarex-projekt.de/en/news/abimo-r-abimo" class="external-link">here</a>) and to
publish it in the form of this R package <a href="https://github.com/KWB-R/kwb.rabimo" class="external-link">kwb.rabimo</a>. Compared to
the original model, R-Abimo is more generic (i.e. can be more easily
adapted to other cities than Berlin) and it contains some additional
features:</p>
<ul>
<li>simulation of stormwater management measures (green roofs,
swales),</li>
<li>“conversion” of urban areas to “natural” areas,</li>
<li>calculation of delta-W, an indicator for the “distance” between the
urban (status quo) state and an assumed “natural” state.</li>
</ul>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>To use the package, you need to have R installed in a version &gt;=
4.3.1. You can download the current version of R from <a href="https://cran.r-project.org/bin/windows/base/" class="external-link">here</a>. Not
necessary, but useful is the usage of an Integrated Development
Environment (IDE), such as RStudio Desktop that can be downloaded from
<a href="https://posit.co/download/rstudio-desktop/" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>In order to install kwb.rabimo directly from our GitHub account <a href="https://github.com/kwb-r/" class="external-link">KWB-R</a>, we recommend to install the
R package remotes first:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package "remotes" from CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span></code></pre></div>
<p>You can then install kwb.rabimo either in the latest “official”
version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package "kwb.rabimo" (latest "release") from GitHub</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"KWB-R/kwb.rabimo"</span><span class="op">)</span></span></code></pre></div>
<p>or in the latest “development” version:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package "kwb.rabimo" (development version) from GitHub</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"KWB-R/kwb.rabimo@dev"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>By setting <code>build_vignettes = TRUE</code> you make sure that
this tutorial vignette is installed together with the package. Please
note that this tutorial is currently only available in the “development”
version.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<div class="section level3">
<h3 id="provide-input-data-and-configuration">Provide input data and configuration<a class="anchor" aria-label="anchor" href="#provide-input-data-and-configuration"></a>
</h3>
<p>Compared to the original C++ version of Abimo we have modified the
structures of input data, output data and configuration. For Berlin,
Germany, we provide data in the new structures in the package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Berlin data in the original Abimo format</span></span>
<span><span class="va">abimo_inputs</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="va"><a href="../reference/rabimo_inputs_2025.html">rabimo_inputs_2025</a></span></span></code></pre></div>
<p>The object <code>abimo_inputs</code> is a list with two elements:</p>
<ul>
<li>
<code>abimo_inputs$data</code> is a data frame containing the actual
input data. Each row represents a block area and each column represents
a block area’s property.</li>
<li>
<code>abimo_inputs$config</code> is a list that configures runoff
factors (for runoff calculation) and Bagrov values (for
evapotranspiration calculation) for different surface types and the
swale evaporation factor that determines which fraction of the water
going into a swale becomes evaporation (the rest becomes
infiltration).</li>
</ul>
<p>You may inspect the first rows (and only the most relevant columns)
of the input data with</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">abimo_inputs</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;               code prec_yr prec_s epot_yr epot_s district total_area      roof</span></span>
<span><span class="co">#&gt; 1 0100980011000100     608    324     666    509        1   4623.972 0.3243243</span></span>
<span><span class="co">#&gt; 2 0100980011000200     607    324     666    509        1  13430.944 0.0004668</span></span>
<span><span class="co">#&gt; 3 0100980011000300     607    324     666    509        1   5603.764 0.3893303</span></span>
<span><span class="co">#&gt; 4 0100980021000200     609    324     666    509        1  34344.730 0.4511181</span></span>
<span><span class="co">#&gt; 5 0100980021000300     608    324     666    509        1  48930.206 0.4155595</span></span>
<span><span class="co">#&gt; 6 0100980021000400     609    324     666    509        1  13977.561 0.0939597</span></span>
<span><span class="co">#&gt;   green_roof swg_roof       pvd swg_pvd srf1_pvd srf2_pvd srf3_pvd srf4_pvd</span></span>
<span><span class="co">#&gt; 1     0.0000     0.86 0.3704374    0.50     0.49     0.46     0.03     0.02</span></span>
<span><span class="co">#&gt; 2     0.0000     0.70 0.4371382    0.68     0.31     0.53     0.07     0.09</span></span>
<span><span class="co">#&gt; 3     0.0939     0.76 0.4414658    0.55     0.20     0.60     0.10     0.10</span></span>
<span><span class="co">#&gt; 4     0.2134     0.94 0.3339549    0.75     0.45     0.28     0.13     0.14</span></span>
<span><span class="co">#&gt; 5     0.0277     0.73 0.3574335    0.61     0.42     0.38     0.08     0.12</span></span>
<span><span class="co">#&gt; 6     0.0000     0.82 0.4508725    0.78     0.31     0.56     0.01     0.12</span></span>
<span><span class="co">#&gt;   srf5_pvd to_swale gw_dist ufc30 ufc150 land_type veg_class irrigation</span></span>
<span><span class="co">#&gt; 1        0        0     5.9    13     10     urban       9.5          0</span></span>
<span><span class="co">#&gt; 2        0        0     5.2    11     10     urban       3.6          0</span></span>
<span><span class="co">#&gt; 3        0        0     4.5    13     10     urban       1.5          0</span></span>
<span><span class="co">#&gt; 4        0        0     5.4    13     10     urban       5.3          0</span></span>
<span><span class="co">#&gt; 5        0        0     5.6    12     10     urban      13.2         50</span></span>
<span><span class="co">#&gt; 6        0        0     4.5    11     10     urban       2.7          0</span></span></code></pre></div>
<p>and you may print the whole configuration object with</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abimo_inputs</span><span class="op">$</span><span class="va">config</span></span>
<span><span class="co">#&gt; $runoff_factors</span></span>
<span><span class="co">#&gt;     roof surface1 surface2 surface3 surface4 surface5 </span></span>
<span><span class="co">#&gt;     1.00     0.90     0.70     0.40     0.10     0.48 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bagrov_values</span></span>
<span><span class="co">#&gt;       roof green_roof   surface1   surface2   surface3   surface4   surface5 </span></span>
<span><span class="co">#&gt;       0.05       0.65       0.11       0.11       0.25       0.40       0.25 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $swale</span></span>
<span><span class="co">#&gt; swale_evaporation_factor </span></span>
<span><span class="co">#&gt;                      0.1</span></span></code></pre></div>
<p>Please refer to the help page of <code>rabimo_inputs_2025</code> for
further information. To open the help page, run</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="va"><a href="../reference/rabimo_inputs_2025.html">rabimo_inputs_2025</a></span></span></code></pre></div>
<p><strong>Note:</strong> We provide also an object
<code>rabimo_inputs_2020</code>, that refers to an older version of the
Berlin data set. It can be used in almost the same way as
<code>rabimo_inputs_2025</code>. However, this old version does not
contain geographical information and we do not cover it within this
tutorial.</p>
<p>Since the we provide the Berlin dataset together with geographical
information we can plot the spatial distribution of a variable (e.g. the
annual precipitation) in the form of a map:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the sf package (simple features) to allow for geographical plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.13.1, GDAL 3.11.0, PROJ 9.6.0; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="co"># Provide a subset of the data representing a zoom into the centre of Berlin</span></span>
<span><span class="va">berlin_zoom</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/crop_box.html">crop_box</a></span><span class="op">(</span></span>
<span>  <span class="va">abimo_inputs</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  xoffset <span class="op">=</span> <span class="fl">0.35</span>, </span>
<span>  yoffset <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>  xscale <span class="op">=</span> <span class="fl">0.07</span>, </span>
<span>  yscale <span class="op">=</span> <span class="fl">0.07</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">#&gt; all geometries</span></span>
<span></span>
<span><span class="co"># Plot annual precipitation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">berlin_zoom</span><span class="op">[</span>, <span class="st">"prec_yr"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Annual precipitation in mm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="run-r-abimo-for-the-status-quo">Run R-Abimo for the status quo<a class="anchor" aria-label="anchor" href="#run-r-abimo-for-the-status-quo"></a>
</h3>
<p>To run R-Abimo, call the main function <code><a href="../reference/run_rabimo.html">run_rabimo()</a></code> by
passing both, the input data and the configuration object, to the
function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run R-Abimo</span></span>
<span><span class="va">water_balance_urban</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/run_rabimo.html">run_rabimo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">berlin_zoom</span>, </span>
<span>  config <span class="op">=</span> <span class="va">abimo_inputs</span><span class="op">$</span><span class="va">config</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Collecting climate related data ... ok. (0.00 secs) </span></span>
<span><span class="co">#&gt; Preparing soil property data for all block areas ... ok. (0.01 secs) </span></span>
<span><span class="co">#&gt; Precalculating actual evapotranspirations for impervious areas ... ok. (0.09 secs) </span></span>
<span><span class="co">#&gt; Precalculating actual evapotranspirations for waterbodies or pervious areas ... ok. (0.03 secs)</span></span>
<span></span>
<span><span class="co"># Have a look at the first lines of the result data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">water_balance_urban</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               code      area  runoff infiltr  evapor</span></span>
<span><span class="co">#&gt; 1 0200010761000000 85207.227 378.040 108.615 116.345</span></span>
<span><span class="co">#&gt; 2 0200010901000100 14948.442   0.000  97.119 512.881</span></span>
<span><span class="co">#&gt; 3 0200010901000200  8911.477 199.563 171.552 240.885</span></span>
<span><span class="co">#&gt; 4 0200010901000300 29381.735  21.930 317.488 272.581</span></span>
<span><span class="co">#&gt; 5 0200010941000100 22281.140 285.523 123.478 194.999</span></span>
<span><span class="co">#&gt; 6 0200010941000200  8264.302 405.532  75.383 128.085</span></span></code></pre></div>
<p>The result data frame contains two columns that are copied from the
input data:</p>
<ul>
<li>
<code>code</code> - unique identifier of each block area,</li>
<li>
<code>area</code> - the total block area in square metres in column
`area</li>
</ul>
<p>as well as three columns containing the model outputs, namely the
water balance components:</p>
<ul>
<li>
<code>runoff</code> - surface runoff in mm,</li>
<li>
<code>infiltration</code> - infiltration in mm, and</li>
<li>
<code>evapor</code> - evaporation in mm.</li>
</ul>
<p>If the model inputs contained geographical information (as in our
case) that information is restored in the output so that the model
results can be plotted in terms of maps:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot model output "runoff"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">water_balance_urban</span><span class="op">[</span>, <span class="st">"runoff"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Annual runoff in mm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/plot_rabimo_results-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot model output "infiltration"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">water_balance_urban</span><span class="op">[</span>, <span class="st">"infiltr"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Annual infiltratio in mm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/plot_rabimo_results-2.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot model output "evaporation"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">water_balance_urban</span><span class="op">[</span>, <span class="st">"evapor"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Annual evaporation in mm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/plot_rabimo_results-3.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="generate-your-own-block-areas">Generate your own block areas<a class="anchor" aria-label="anchor" href="#generate-your-own-block-areas"></a>
</h3>
<p>The package provides a function to generate a row in the format that
R-Abimo requires. You need to pass at least the unique identifier(s)
(<code>code</code>) for the block area(s). If you leave all the other
arguments blank, you get (a) default block area(s). However, you can
override the default values by passing arguments that are named
according to the names of the input columns:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate artificial block areas, using default values and differing only in </span></span>
<span><span class="co"># the fractions of the areas that are refer to roofs</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"area-"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">art_blocks</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/generate_rabimo_area.html">generate_rabimo_area</a></span><span class="op">(</span></span>
<span>  code <span class="op">=</span> <span class="va">codes</span>, </span>
<span>  roof <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Have a look at the data</span></span>
<span><span class="va">art_blocks</span></span>
<span><span class="co">#&gt;     code prec_yr prec_s epot_yr epot_s district total_area main_frac roof</span></span>
<span><span class="co">#&gt; 1 area-1     600    300     700    500        0        100         1 0.00</span></span>
<span><span class="co">#&gt; 2 area-2     600    300     700    500        0        100         1 0.25</span></span>
<span><span class="co">#&gt; 3 area-3     600    300     700    500        0        100         1 0.50</span></span>
<span><span class="co">#&gt; 4 area-4     600    300     700    500        0        100         1 0.75</span></span>
<span><span class="co">#&gt; 5 area-5     600    300     700    500        0        100         1 1.00</span></span>
<span><span class="co">#&gt;   green_roof swg_roof pvd swg_pvd srf1_pvd srf2_pvd srf3_pvd srf4_pvd srf5_pvd</span></span>
<span><span class="co">#&gt; 1          0        1 0.6     0.7      0.5      0.2      0.1      0.1      0.1</span></span>
<span><span class="co">#&gt; 2          0        1 0.6     0.7      0.5      0.2      0.1      0.1      0.1</span></span>
<span><span class="co">#&gt; 3          0        1 0.6     0.7      0.5      0.2      0.1      0.1      0.1</span></span>
<span><span class="co">#&gt; 4          0        1 0.6     0.7      0.5      0.2      0.1      0.1      0.1</span></span>
<span><span class="co">#&gt; 5          0        1 0.6     0.7      0.5      0.2      0.1      0.1      0.1</span></span>
<span><span class="co">#&gt;   road_frac pvd_r swg_pvd_r srf1_pvd_r srf2_pvd_r srf3_pvd_r srf4_pvd_r</span></span>
<span><span class="co">#&gt; 1         0   0.9         1        0.9        0.1          0          0</span></span>
<span><span class="co">#&gt; 2         0   0.9         1        0.9        0.1          0          0</span></span>
<span><span class="co">#&gt; 3         0   0.9         1        0.9        0.1          0          0</span></span>
<span><span class="co">#&gt; 4         0   0.9         1        0.9        0.1          0          0</span></span>
<span><span class="co">#&gt; 5         0   0.9         1        0.9        0.1          0          0</span></span>
<span><span class="co">#&gt;   to_swale gw_dist ufc30 ufc150 land_type veg_class irrigation</span></span>
<span><span class="co">#&gt; 1        0       3    13     13     urban        35          0</span></span>
<span><span class="co">#&gt; 2        0       3    13     13     urban        35          0</span></span>
<span><span class="co">#&gt; 3        0       3    13     13     urban        35          0</span></span>
<span><span class="co">#&gt; 4        0       3    13     13     urban        35          0</span></span>
<span><span class="co">#&gt; 5        0       3    13     13     urban        35          0</span></span>
<span></span>
<span><span class="co"># Run R-Abimo on the block areas</span></span>
<span><span class="va">art_water_balance</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/run_rabimo.html">run_rabimo</a></span><span class="op">(</span><span class="va">art_blocks</span>, config <span class="op">=</span> <span class="va">abimo_inputs</span><span class="op">$</span><span class="va">config</span><span class="op">)</span></span>
<span><span class="co">#&gt; Collecting climate related data ... ok. (0.00 secs) </span></span>
<span><span class="co">#&gt; Preparing soil property data for all block areas ... ok. (0.00 secs) </span></span>
<span><span class="co">#&gt; Precalculating actual evapotranspirations for impervious areas ... ok. (0.01 secs) </span></span>
<span><span class="co">#&gt; Precalculating actual evapotranspirations for waterbodies or pervious areas ... ok. (0.00 secs)</span></span>
<span></span>
<span><span class="co"># How does the roof area influence the runoff?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">art_blocks</span><span class="op">$</span><span class="va">roof</span>, <span class="va">art_water_balance</span><span class="op">$</span><span class="va">runoff</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/generate_block_areas-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="comparison-of-urban-state-with-natural-state">Comparison of urban state with natural state<a class="anchor" aria-label="anchor" href="#comparison-of-urban-state-with-natural-state"></a>
</h2>
<p>In the research project <a href="https://amarex-projekt.de/de" class="external-link">AMAREX</a> we propose to use the
deviation of the water balances that are simulated for both, the current
(urban) state and for an assumed “natural” state as an indicator for the
vulnerability of an urban area to climate change effects (such as heat,
flooding, negative impacts on the surface water quality). As a measure
of deviation we introduce
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>W</mi></mrow><annotation encoding="application/x-tex">\Delta W</annotation></semantics></math>
that is calculated as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>W</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>e</mi><mrow><mi>n</mi><mi>a</mi><mi>t</mi></mrow></msub><mo>−</mo><msub><mi>e</mi><mrow><mi>u</mi><mi>r</mi><mi>b</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>i</mi><mrow><mi>n</mi><mi>a</mi><mi>t</mi></mrow></msub><mo>−</mo><msub><mi>i</mi><mrow><mi>u</mi><mi>r</mi><mi>b</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>r</mi><mrow><mi>n</mi><mi>a</mi><mi>t</mi></mrow></msub><mo>−</mo><msub><mi>r</mi><mrow><mi>u</mi><mi>r</mi><mi>b</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta W = \frac{1}{2}(|e_{nat}-e_{urb}|+|i_{nat}-i_{urb}|+|r_{nat}-r_{urb}|)</annotation></semantics></math>
with</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>n</mi><mi>a</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">e_{nat}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>u</mi><mi>r</mi><mi>b</mi></mrow></msub><annotation encoding="application/x-tex">e_{urb}</annotation></semantics></math>
= evaporation for the natural and urban state, respectively,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>i</mi><mrow><mi>n</mi><mi>a</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">i_{nat}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>i</mi><mrow><mi>u</mi><mi>r</mi><mi>b</mi></mrow></msub><annotation encoding="application/x-tex">i_{urb}</annotation></semantics></math>
= infiltration for the natural and urban state, respectively,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mrow><mi>n</mi><mi>a</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">r_{nat}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mrow><mi>u</mi><mi>r</mi><mi>b</mi></mrow></msub><annotation encoding="application/x-tex">r_{urb}</annotation></semantics></math>
= runoff for the natural and urban state, respectively.</li>
</ul>
<p>The higher the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>W</mi></mrow><annotation encoding="application/x-tex">\Delta W</annotation></semantics></math>
the more different are the water balance components, i.e. the less
similar the urban area is to a natural area. The lower the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>W</mi></mrow><annotation encoding="application/x-tex">\Delta W</annotation></semantics></math>
the less different are the water balance components, i.e. the more
similar the urban area is to a natural area.</p>
<p>The hypothesis is that a lower value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>W</mi></mrow><annotation encoding="application/x-tex">\Delta W</annotation></semantics></math>
indicates a better preparedness to climate change effects (e.g. because
increased evaporation as it occurs in a natural state scenario leads to
a reduction of heat).</p>
<div class="section level3">
<h3 id="run-r-abimo-for-a-natural-state-scenario">Run R-Abimo for a natural state scenario<a class="anchor" aria-label="anchor" href="#run-r-abimo-for-a-natural-state-scenario"></a>
</h3>
<p>In the package we provide a function <code><a href="../reference/data_to_natural.html">data_to_natural()</a></code>
that converts a set of urban block areas to corresponding “natural”
block areas. The function converts all roof areas and unbuilt paved
areas to pervious areas and assumes an overall vegetation as it can be
found in a park (a mixture of meadows, bushes and trees).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert urban state to "natural" state</span></span>
<span><span class="va">berlin_zoom_natural</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/data_to_natural.html">data_to_natural</a></span><span class="op">(</span><span class="va">berlin_zoom</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the water balance for the "natural" state</span></span>
<span><span class="va">water_balance_natural</span> <span class="op">&lt;-</span> <span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/run_rabimo.html">run_rabimo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">berlin_zoom_natural</span>, </span>
<span>  config <span class="op">=</span> <span class="va">abimo_inputs</span><span class="op">$</span><span class="va">config</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Collecting climate related data ... ok. (0.00 secs) </span></span>
<span><span class="co">#&gt; Preparing soil property data for all block areas ... ok. (0.01 secs) </span></span>
<span><span class="co">#&gt; Precalculating actual evapotranspirations for impervious areas ... ok. (0.10 secs) </span></span>
<span><span class="co">#&gt; Precalculating actual evapotranspirations for waterbodies or pervious areas ... ok. (0.01 secs)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-delta-w">Calculate “Delta-W”<a class="anchor" aria-label="anchor" href="#calculate-delta-w"></a>
</h3>
<p>For the first ten blocks, calculate the deviation from the natural
state:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kwb.rabimo</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_delta_W.html">calculate_delta_w</a></span><span class="op">(</span></span>
<span>  urban <span class="op">=</span> <span class="va">rabimo_result</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>,</span>
<span>  natural <span class="op">=</span> <span class="va">rabimo_result_natural</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>TODO: - calculate_delta_w - RWBM - sehr kurze Intro zu den
implementierten RWBM (inkl. dass man den pvd Anteil ändern kann?) - wie
man gezielt einen Wert in einer bestimmten Spalte (z.B. green_roof) oder
in alle Spalten ändert - Plot von vorher vs. nachher</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hauke Sonnenberg, Francesco Del Punta.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
